Ext.onReady(function(){Ext.Ajax.method="GET";PT={core:{instances:[]},i18n:{},isDebug:false,isSessionStorage:"sessionStorage" in window&&window.sessionStorage!==null};PT.core.getInstance=function(m){var i={},h={},k={},g={},j={},l;(function(){i.finals={url:{path_module:"/dhis-web-pivot/",path_api:"/api/",path_commons:"/dhis-web-commons-ajax-json/",data_get:"chartValues.json",indicator_get:"indicatorGroups/",indicator_getall:"indicators.json?paging=false&links=false",indicatorgroup_get:"indicatorGroups.json?paging=false&links=false",dataelement_get:"dataElementGroups/",dataelement_getall:"dataElements.json?paging=false&links=false",dataelementgroup_get:"dataElementGroups.json?paging=false&links=false",dataset_get:"dataSets.json?paging=false&links=false",organisationunit_getbygroup:"getOrganisationUnitPathsByGroup.action",organisationunit_getbylevel:"getOrganisationUnitPathsByLevel.action",organisationunit_getbyids:"getOrganisationUnitPaths.action",organisationunitgroup_getall:"organisationUnitGroups.json?paging=false&links=false",organisationunitgroupset_get:"getOrganisationUnitGroupSetsMinified.action",organisationunitlevel_getall:"organisationUnitLevels.json?paging=false&links=false&viewClass=detailed",organisationunitchildren_get:"getOrganisationUnitChildren.action",favorite_addorupdate:"addOrUpdateChart.action",favorite_addorupdatesystem:"addOrUpdateSystemChart.action",favorite_updatename:"updateChartName.action",favorite_get:"charts/",favorite_getall:"getSystemAndCurrentUserCharts.action",favorite_delete:"deleteCharts.action"},dimension:{data:{value:"data",name:PT.i18n.data,dimensionName:"dx",objectName:"dx",warning:{filter:"..."}},category:{name:PT.i18n.categories,dimensionName:"co",objectName:"co"},indicator:{value:"indicators",name:PT.i18n.indicators,dimensionName:"dx",objectName:"in"},dataElement:{value:"dataElements",name:PT.i18n.data_elements,dimensionName:"dx",objectName:"de"},operand:{value:"operand",name:"Operand",dimensionName:"dx",objectName:"dc"},dataSet:{value:"dataSets",name:PT.i18n.data_sets,dimensionName:"dx",objectName:"ds"},period:{value:"period",name:PT.i18n.periods,dimensionName:"pe",objectName:"pe"},fixedPeriod:{value:"periods"},relativePeriod:{value:"relativePeriods"},organisationUnit:{value:"organisationUnits",name:PT.i18n.organisation_units,dimensionName:"ou",objectName:"ou"},dimension:{value:"dimension"},value:{value:"value"}},root:{id:"root"}};l=i.finals.dimension;l.objectNameMap={};l.objectNameMap[l.data.objectName]=l.data;l.objectNameMap[l.indicator.objectName]=l.indicator;l.objectNameMap[l.dataElement.objectName]=l.dataElement;l.objectNameMap[l.operand.objectName]=l.operand;l.objectNameMap[l.dataSet.objectName]=l.dataSet;l.objectNameMap[l.category.objectName]=l.category;l.objectNameMap[l.period.objectName]=l.period;l.objectNameMap[l.organisationUnit.objectName]=l.organisationUnit;l.objectNameMap[l.dimension.objectName]=l.dimension;i.period={relativePeriods:{LAST_WEEK:1,LAST_4_WEEKS:4,LAST_12_WEEKS:12,LAST_MONTH:1,LAST_3_MONTHS:3,LAST_BIMONTH:1,LAST_6_BIMONTHS:6,LAST_12_MONTHS:12,LAST_QUARTER:1,LAST_4_QUARTERS:4,LAST_SIX_MONTH:1,LAST_2_SIXMONTHS:2,LAST_FINANCIAL_YEAR:1,LAST_5_FINANCIAL_YEARS:6,THIS_YEAR:1,LAST_YEAR:1,LAST_5_YEARS:5},relativePeriodValueKeys:{LAST_WEEK:"lastWeek",LAST_4_WEEKS:"last4Weeks",LAST_12_WEEKS:"last12Weeks",LAST_MONTH:"lastMonth",LAST_3_MONTHS:"last3Months",LAST_12_MONTHS:"last12Months",LAST_BIMONTH:"lastBimonth",LAST_6_BIMONTHS:"last6BiMonths",LAST_QUARTER:"lastQuarter",LAST_4_QUARTERS:"last4Quarters",LAST_SIX_MONTH:"lastSixMonth",LAST_2_SIXMONTHS:"last2SixMonths",LAST_FINANCIAL_YEAR:"lastFinancialYear",LAST_5_FINANCIAL_YEARS:"last5FinancialYears",THIS_YEAR:"thisYear",LAST_YEAR:"lastYear",LAST_5_YEARS:"last5Years"},relativePeriodParamKeys:{lastWeek:"LAST_WEEK",last4Weeks:"LAST_4_WEEKS",last12Weeks:"LAST_12_WEEKS",lastMonth:"LAST_MONTH",last3Months:"LAST_3_MONTHS",last12Months:"LAST_12_MONTHS",lastBimonth:"LAST_BIMONTH",last6BiMonths:"LAST_6_BIMONTHS",lastQuarter:"LAST_QUARTER",last4Quarters:"LAST_4_QUARTERS",lastSixMonth:"LAST_SIX_MONTH",last2SixMonths:"LAST_2_SIXMONTHS",lastFinancialYear:"LAST_FINANCIAL_YEAR",last5FinancialYears:"LAST_5_FINANCIAL_YEARS",thisYear:"THIS_YEAR",lastYear:"LAST_YEAR",last5Years:"LAST_5_YEARS"},periodTypes:[{id:"Daily",name:"Daily"},{id:"Weekly",name:"Weekly"},{id:"Monthly",name:"Monthly"},{id:"BiMonthly",name:"BiMonthly"},{id:"Quarterly",name:"Quarterly"},{id:"SixMonthly",name:"SixMonthly"},{id:"Yearly",name:"Yearly"},{id:"FinancialOct",name:"FinancialOct"},{id:"FinancialJuly",name:"FinancialJuly"},{id:"FinancialApril",name:"FinancialApril"}]};i.layout={west_width:424,west_fieldset_width:416,west_width_padding:4,west_fill:2,west_fill_accordion_indicator:59,west_fill_accordion_dataelement:59,west_fill_accordion_dataset:33,west_fill_accordion_period:296,west_fill_accordion_organisationunit:62,west_maxheight_accordion_indicator:400,west_maxheight_accordion_dataelement:400,west_maxheight_accordion_dataset:400,west_maxheight_accordion_period:513,west_maxheight_accordion_organisationunit:900,west_maxheight_accordion_group:340,west_maxheight_accordion_options:449,west_scrollbarheight_accordion_indicator:300,west_scrollbarheight_accordion_dataelement:300,west_scrollbarheight_accordion_dataset:300,west_scrollbarheight_accordion_period:450,west_scrollbarheight_accordion_organisationunit:450,west_scrollbarheight_accordion_group:300,east_tbar_height:31,east_gridcolumn_height:30,form_label_width:55,window_favorite_ypos:100,window_confirm_width:250,window_share_width:500,grid_favorite_width:420,grid_row_height:27,treepanel_minheight:135,treepanel_maxheight:400,treepanel_fill_default:310,treepanel_toolbar_menu_width_group:140,treepanel_toolbar_menu_width_level:120,multiselect_minheight:100,multiselect_maxheight:250,multiselect_fill_default:345,multiselect_fill_reportingrates:315};i.pivot={digitGroupSeparator:{comma:",",space:" "},displayDensity:{compact:"3px",normal:"5px",comfortable:"10px"},fontSize:{small:"10px",normal:"11px",large:"13px"}}}());(function(){h.object={getLength:function(n){var p=0;for(var o in n){if(n.hasOwnProperty(o)){p++}}return p}};h.mask={showMask:function(n,o){o=o||"Loading..";if(n.mask&&n.mask.destroy){n.mask.destroy()}n.mask=new Ext.LoadMask(n,{msg:o});n.mask.show()},hideMask:function(n){if(n.mask&&n.mask.hide){n.mask.hide()}}};h.store={addToStorage:function(o,n){o.each(function(p){if(!o.storage[p.data.id]){o.storage[p.data.id]={id:p.data.id,name:p.data.name,parent:o.parent}}});if(n){Ext.Array.each(n,function(p){if(!o.storage[p.data.id]){o.storage[p.data.id]={id:p.data.id,name:p.data.name,parent:o.parent}}})}},loadFromStorage:function(o){var n=[];o.removeAll();for(var p in o.storage){if(o.storage[p].parent===o.parent){n.push(o.storage[p])}}o.add(n);o.sort("name","ASC")},containsParent:function(n){for(var o in n.storage){if(n.storage[o].parent===n.parent){return true}}return false}};h.array={sortDimensions:function(p,o){o=o||"dimensionName";Ext.Array.sort(p,function(s,r){if(s[o]<r[o]){return -1}if(s[o]>r[o]){return 1}return 0});for(var n=0,q;n<p.length;n++){q=p[n];if(q.items){p[n].items=h.array.sortDimensions(q.items,"id")}if(q.ids){p[n].ids=q.ids.sort()}}return p},sortObjectsByString:function(o,n){n=n||"name";o.sort(function(q,p){var s=q[n].toLowerCase(),r=p[n].toLowerCase();if(s<r){return -1}if(s>r){return 1}return 0});return o}};h.number={getNumberOfDecimals:function(n){var o=new String(n);return(o.indexOf(".")>-1)?(o.length-o.indexOf(".")-1):0},roundIf:function(n,o){n=parseFloat(n);o=parseFloat(o);if(Ext.isNumber(n)&&Ext.isNumber(o)){var p=h.number.getNumberOfDecimals(n);return p>o?Ext.Number.toFixed(n,o):n}return n},pp:function(n,o){o=o||"space";if(o==="none"){return n}return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,i.pivot.digitGroupSeparator[o])}};h.str={replaceAll:function(p,o,n){return p.replace(new RegExp(o,"g"),n)}};h.color={hexToRgb:function(p){var o=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;p=p.replace(o,function(s,u,t,q){return u+u+t+t+q+q});var n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(p);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:null},getContrast:function(p){if(Ext.isString(p)){var n=h.color.hexToRgb(p),o=(n.r+n.g+n.b);if(o<210){return"#ffffff"}}return"#000000"}};h.message={alert:function(n){alert(n)}}}());(function(){m.dimensions=h.array.sortObjectsByString(m.dimensions);for(var n=0,o;n<m.dimensions.length;n++){o=m.dimensions[n];o.dimensionName=o.id;o.objectName=i.finals.dimension.dimension.objectName;i.finals.dimension.objectNameMap[o.id]=o}m.idLegendSetMap={};for(var n=0,p;n<m.legendSets.length;n++){p=m.legendSets[n];m.idLegendSetMap[p.id]=p}}());(function(){k.layout={};k.layout.Record=function(o){var n={};return function(){if(!Ext.isObject(o)){console.log("Record config is not an object: "+o);return}if(!Ext.isString(o.id)){alert("Record id is not text: "+o);return}n.id=o.id.replace(".","-");if(Ext.isString(o.name)){n.name=o.name}return Ext.clone(n)}()};k.layout.Dimension=function(n){var o={};return function(){if(!Ext.isObject(n)){console.log("Dimension config is not an object: "+n);return}if(!Ext.isString(n.dimension)){console.log("Dimension name is not text: "+n);return}if(n.dimension!==i.finals.dimension.category.objectName){var p=[];if(!Ext.isArray(n.items)){console.log("Dimension items is not an array: "+n);return}for(var q=0;q<n.items.length;q++){record=k.layout.Record(n.items[q]);if(record){p.push(record)}}n.items=p;if(!n.items.length){console.log("Dimension has no valid items: "+n);return}}o.dimension=n.dimension;o.items=n.items;return Ext.clone(o)}()};k.layout.Layout=function(o){var p={},n,q;n=function(u){var s=[];if(!(u&&Ext.isArray(u)&&u.length)){return}for(var r=0,t;r<u.length;r++){t=k.layout.Dimension(u[r]);if(t){s.push(t)}}u=s;return u.length?u:null};q=function(){var t=i.finals.dimension,s,u={};if(!p){return}s=Ext.Array.clean([].concat(p.columns,p.rows,p.filters));for(var r=0;r<s.length;r++){u[s[r].dimension]=s[r]}if(p.filters&&p.filters.length){for(var r=0;r<p.filters.length;r++){if(p.filters[r].dimension===t.indicator.objectName){h.message.alert(PT.i18n.indicators_cannot_be_specified_as_filter||"Indicators cannot be specified as filter");return}if(p.filters[r].dimension===t.category.objectName){h.message.alert(PT.i18n.categories_cannot_be_specified_as_filter||"Categories cannot be specified as filter");return}if(p.filters[r].dimension===t.dataSet.objectName){h.message.alert(PT.i18n.data_sets_cannot_be_specified_as_filter||"Data sets cannot be specified as filter");return}}}if(u[t.operand.objectName]&&u[t.indicator.objectName]){h.message.alert("Indicators and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataElement.objectName]){h.message.alert("Detailed data elements and totals cannot be specified together");return}if(u[t.operand.objectName]&&u[t.dataSet.objectName]){h.message.alert("Data sets and detailed data elements cannot be specified together");return}if(u[t.operand.objectName]&&u[t.category.objectName]){h.message.alert("Categories and detailed data elements cannot be specified together");return}return true};return function(){var x=[],w=[],z=i.finals.dimension,y,s=false,r=false,A=false;o.columns=n(o.columns);o.rows=n(o.rows);o.filters=n(o.filters);if(!(o&&Ext.isObject(o))){alert(m.el+": Layout config is not an object");return}if(!(o.columns||o.rows)){alert(PT.i18n.at_least_one_dimension_must_be_specified_as_row_or_column);return}for(var u=0,v,y=[].concat(o.columns||[],o.rows||[],o.filters||[]);u<y.length;u++){v=y[u];if(v){if(Ext.isString(v.dimension)){w.push(v.dimension)}if(v.dimension===z.organisationUnit.objectName&&Ext.isArray(v.items)){for(var t=0;t<v.items.length;t++){if(v.items[t].id==="USER_ORGUNIT"){s=true}else{if(v.items[t].id==="USER_ORGUNIT_CHILDREN"){r=true}else{if(v.items[t].id==="USER_ORGUNIT_GRANDCHILDREN"){A=true}}}}}}}if(!Ext.Array.contains(w,z.period.objectName)){alert(PT.i18n.at_least_one_period_must_be_specified_as_column_row_or_filter);return}p.columns=o.columns;p.rows=o.rows;p.filters=o.filters;p.showTotals=Ext.isBoolean(o.totals)?o.totals:(Ext.isBoolean(o.showTotals)?o.showTotals:true);p.showSubTotals=Ext.isBoolean(o.subtotals)?o.subtotals:(Ext.isBoolean(o.showSubTotals)?o.showSubTotals:true);p.hideEmptyRows=Ext.isBoolean(o.hideEmptyRows)?o.hideEmptyRows:false;p.showHierarchy=Ext.isBoolean(o.showHierarchy)?o.showHierarchy:false;p.displayDensity=Ext.isString(o.displayDensity)&&!Ext.isEmpty(o.displayDensity)?o.displayDensity:"normal";p.fontSize=Ext.isString(o.fontSize)&&!Ext.isEmpty(o.fontSize)?o.fontSize:"normal";p.digitGroupSeparator=Ext.isString(o.digitGroupSeparator)&&!Ext.isEmpty(o.digitGroupSeparator)?o.digitGroupSeparator:"space";p.legendSet=Ext.isObject(o.legendSet)&&Ext.isString(o.legendSet.id)?o.legendSet:null;p.userOrganisationUnit=s;p.userOrganisationUnitChildren=r;p.userOrganisationUnitGrandChildren=A;p.parentGraphMap=Ext.isObject(o.parentGraphMap)?o.parentGraphMap:null;p.reportingPeriod=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramReportingPeriod)?o.reportParams.paramReportingPeriod:(Ext.isBoolean(o.reportingPeriod)?o.reportingPeriod:false);p.organisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramOrganisationUnit)?o.reportParams.paramOrganisationUnit:(Ext.isBoolean(o.organisationUnit)?o.organisationUnit:false);p.parentOrganisationUnit=Ext.isObject(o.reportParams)&&Ext.isBoolean(o.reportParams.paramParentOrganisationUnit)?o.reportParams.paramParentOrganisationUnit:(Ext.isBoolean(o.parentOrganisationUnit)?o.parentOrganisationUnit:false);p.regression=Ext.isBoolean(o.regression)?o.regression:false;p.cumulative=Ext.isBoolean(o.cumulative)?o.cumulative:false;p.sortOrder=Ext.isNumber(o.sortOrder)?o.sortOrder:0;p.topLimit=Ext.isNumber(o.topLimit)?o.topLimit:0;if(!q()){return}return Ext.clone(p)}()};k.response={};k.response.Header=function(n){var o={};return function(){if(!Ext.isObject(n)){console.log("Header is not an object: "+n);return}if(!Ext.isString(n.name)){console.log("Header name is not text: "+n);return}if(!Ext.isBoolean(n.meta)){console.log("Header meta is not boolean: "+n);return}o.name=n.name;o.meta=n.meta;return Ext.clone(o)}()};k.response.Response=function(o){var n={};return function(){var q=[];if(!(o&&Ext.isObject(o))){alert("Data response invalid");return false}if(!(o.headers&&Ext.isArray(o.headers))){alert("Data response invalid");return false}for(var p=0,r;p<o.headers.length;p++){r=k.response.Header(o.headers[p]);if(r){q.push(r)}}o.headers=q;if(!o.headers.length){alert("No valid response headers");return}if(!(Ext.isArray(o.rows)&&o.rows.length>0)){alert("No values found");return false}if(o.headers.length!==o.rows[0].length){alert("Data invalid");return false}n.headers=o.headers;n.metaData=o.metaData;n.width=o.width;n.height=o.height;n.rows=o.rows;return n}()}}());(function(){g.layout={};g.layout.getObjectNameDimensionMap=function(q){var p={};if(Ext.isArray(q)&&q.length){for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o}}}return p};g.layout.getObjectNameDimensionItemsMap=function(q){var p={};if(Ext.isArray(q)&&q.length){for(var n=0,o;n<q.length;n++){o=k.layout.Dimension(q[n]);if(o){p[o.dimension]=o.items}}}return p};g.response={}}());(function(){j.getExtendedLayout=function(s){var s=Ext.clone(s),u={columns:[],rows:[],filters:[],columnObjectNames:[],columnDimensionNames:[],rowObjectNames:[],rowDimensionNames:[],axisDimensions:[],axisObjectNames:[],axisDimensionNames:[],sortedAxisDimensionNames:[],filterDimensions:[],filterObjectNames:[],filterDimensionNames:[],sortedFilterDimensions:[],dimensions:[],objectNames:[],dimensionNames:[],objectNameDimensionsMap:{},objectNameItemsMap:{},objectNameIdsMap:{},dimensionNameDimensionsMap:{},dimensionNameItemsMap:{},dimensionNameIdsMap:{},dimensionNameSortedIdsMap:{}};Ext.applyIf(u,s);if(s.columns){for(var q=0,r,t,n;q<s.columns.length;q++){r=s.columns[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.columns.push(n);u.columnObjectNames.push(n.objectName);u.columnDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}if(s.rows){for(var q=0,r,t,n;q<s.rows.length;q++){r=Ext.clone(s.rows[q]);t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.rows.push(n);u.rowObjectNames.push(n.objectName);u.rowDimensionNames.push(n.dimensionName);u.axisDimensions.push(n);u.axisObjectNames.push(n.objectName);u.axisDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}if(s.filters){for(var q=0,r,t,n;q<s.filters.length;q++){r=s.filters[q];t=r.items;n={};n.dimension=r.dimension;n.objectName=r.dimension;n.dimensionName=l.objectNameMap[r.dimension].dimensionName;if(t){n.items=t;n.ids=[];for(var p=0;p<t.length;p++){n.ids.push(t[p].id)}}u.filters.push(n);u.filterDimensions.push(n);u.filterObjectNames.push(n.objectName);u.filterDimensionNames.push(l.objectNameMap[n.objectName].dimensionName);u.objectNameDimensionsMap[n.objectName]=n;u.objectNameItemsMap[n.objectName]=n.items;u.objectNameIdsMap[n.objectName]=n.ids}}u.axisDimensionNames=Ext.Array.unique(u.axisDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.columnDimensionNames=Ext.Array.unique(u.columnDimensionNames);u.rowDimensionNames=Ext.Array.unique(u.rowDimensionNames);u.filterDimensionNames=Ext.Array.unique(u.filterDimensionNames);u.sortedAxisDimensionNames=Ext.clone(u.axisDimensionNames).sort();u.sortedFilterDimensions=h.array.sortDimensions(Ext.clone(u.filterDimensions));u.dimensions=[].concat(u.axisDimensions,u.filterDimensions);u.objectNames=[].concat(u.axisObjectNames,u.filterObjectNames);u.dimensionNames=[].concat(u.axisDimensionNames,u.filterDimensionNames);for(var q=0,o;q<u.dimensionNames.length;q++){o=u.dimensionNames[q];u.dimensionNameDimensionsMap[o]=[];u.dimensionNameItemsMap[o]=[];u.dimensionNameIdsMap[o]=[]}for(var q=0,n;q<u.dimensions.length;q++){n=u.dimensions[q];u.dimensionNameDimensionsMap[n.dimensionName].push(n);u.dimensionNameItemsMap[n.dimensionName]=u.dimensionNameItemsMap[n.dimensionName].concat(n.items);u.dimensionNameIdsMap[n.dimensionName]=u.dimensionNameIdsMap[n.dimensionName].concat(n.ids)}for(var v in u.dimensionNameIdsMap){if(u.dimensionNameIdsMap.hasOwnProperty(v)){u.dimensionNameSortedIdsMap[v]=Ext.clone(u.dimensionNameIdsMap[v]).sort()}}return u};j.getParamString=function(A,q){var u=q?A.sortedAxisDimensionNames:A.axisDimensionNames,C=q?A.sortedFilterDimensions:A.filterDimensions,n=q?A.dimensionNameSortedIdsMap:A.dimensionNameIdsMap,r="?",B=i.finals.dimension,p=false,o=A.dimensionNameItemsMap,D=B.indicator.dimensionName,z=B.category.dimensionName;for(var v=0,s,y;v<u.length;v++){s=u[v];r+="dimension="+s;y=Ext.clone(n[s]);if(s===D){for(var t=0,x;t<y.length;t++){x=y[t].indexOf("-");if(x>0){p=true;y[t]=y[t].substr(0,x)}}y=Ext.Array.unique(y)}if(s!==z){r+=":"+y.join(";")}if(v<(u.length-1)){r+="&"}}if(p){r+="&dimension="+i.finals.dimension.category.dimensionName}if(Ext.isArray(C)&&C.length){for(var v=0,w;v<C.length;v++){w=C[v];r+="&filter="+w.dimensionName+":"+w.ids.join(";")}}if(A.showHierarchy){r+="&hierarchyMeta=true"}return r};j.setSessionStorage=function(q,p,o){if(PT.isSessionStorage){var n=JSON.parse(sessionStorage.getItem("dhis2"))||{};n[q]=p;sessionStorage.setItem("dhis2",JSON.stringify(n));if(Ext.isString(o)){window.location.href=o}}};j.createTable=function(C,x,w,s){var o=C.legendSet?x.init.idLegendSetMap[C.legendSet.id]:null,q,A,u,r,p,y,z,B,n,t,E=x.init.el+"_"+Ext.data.IdGenerator.get("uuid").generate(),v={},D={};q=function(G,F){return C.showHierarchy&&Ext.isObject(F.metaData.ouHierarchy)&&F.metaData.ouHierarchy.hasOwnProperty(G)};A=function(L,H,K){var G=H.metaData,I="";if(q(L,H)){var F=Ext.clean(G.ouHierarchy[L].split("/"));F.shift();for(var J=0;J<F.length;J++){I+=(K?'<span class="text-weak">':"")+G.names[F[J]]+(K?"</span>":"")+" / "}}I+=G.names[L];return I};u=function(G,F){var I,J,H=[].concat(G.columns||[],G.rows||[],G.filters||[]);I=function(L){var K;K=function(N){var O;N=Ext.clone(N);for(var M=0;M<N.length;M++){if(N[M].dimension===L){O=N[M]}}if(O){Ext.Array.remove(N,O)}return N};if(G.columns){G.columns=K(G.columns)}if(G.rows){G.rows=K(G.rows)}if(G.filters){G.filters=K(G.filters)}};J=function(){var L=[];for(var K=0;K<F.headers.length;K++){L.push(F.headers[K].name)}return L};return function(){var L=J(),ag=G.objectNameDimensionsMap[l.organisationUnit.objectName],R=ag&&Ext.Array.contains(ag.ids,"USER_ORGUNIT"),ai=ag&&Ext.Array.contains(ag.ids,"USER_ORGUNIT_CHILDREN"),af=ag&&Ext.Array.contains(ag.ids,"USER_ORGUNIT_GRANDCHILDREN"),K=function(){if(ag&&Ext.isArray(ag.ids)){for(var ak=0;ak<ag.ids.length;ak++){if(ag.ids[ak].substr(0,5)==="LEVEL"){return true}}}return false}(),T=function(){if(ag&&Ext.isArray(ag.ids)){for(var ak=0;ak<ag.ids.length;ak++){if(ag.ids[ak].substr(0,8)==="OU_GROUP"){return true}}}return false}(),Q=l.category.objectName,N=l.organisationUnit.objectName,aj;for(var ab=0,Z,S,U;ab<H.length;ab++){Z=H[ab];Z.items=[];S=F.metaData[Z.objectName];if(Z.dimensionName===N){if(R||ai||af){var ae,P,W;if(R){ae=[{id:x.init.user.ou,name:A(x.init.user.ou,F)}]}if(ai){P=[];for(var Y=0;Y<x.init.user.ouc.length;Y++){P.push({id:x.init.user.ouc[Y],name:A(x.init.user.ouc[Y],F)})}P=x.util.array.sortObjectsByString(P)}if(af){var M=[].concat(x.init.user.ou,x.init.user.ouc),O=F.metaData[N];W=[];for(var Y=0,V;Y<O.length;Y++){V=O[Y];if(!Ext.Array.contains(M,V)){W.push({id:V,name:A(V,F)})}}W=x.util.array.sortObjectsByString(W)}Z.items=[].concat(ae||[],P||[],W||[])}else{if(K||T){for(var Y=0,O=F.metaData[N],V;Y<O.length;Y++){V=O[Y];Z.items.push({id:V,name:A(V,F)})}Z.items=x.util.array.sortObjectsByString(Z.items)}else{Z.items=Ext.clone(G.dimensionNameItemsMap[Z.dimensionName])}}}else{if(Ext.isArray(S)&&S.length){var X=Ext.clone(F.metaData[Z.dimensionName]);for(var Y=0;Y<X.length;Y++){Z.items.push({id:X[Y],name:F.metaData.names[X[Y]]})}}else{Z.items=Ext.clone(G.objectNameItemsMap[Z.objectName])}}}for(var ab=0,ac;ab<G.axisDimensionNames.length;ab++){ac=G.axisDimensionNames[ab];if(!Ext.Array.contains(L,ac)){I(ac)}}aj=x.api.layout.Layout(G);if(aj){H=[].concat(aj.columns||[],aj.rows||[],aj.filters||[]);for(var ab=0,aa=F.metaData.names,ad;ab<H.length;ab++){ad=H[ab].items;if(Ext.isArray(ad)&&ad.length){for(var Y=0,ah;Y<ad.length;Y++){ah=ad[Y];if(Ext.isObject(ah)&&Ext.isString(aa[ah.id])&&!Ext.isString(ah.name)){ah.name=aa[ah.id]||""}}}}return j.getExtendedLayout(aj)}return null}()};r=function(I,H){I.nameHeaderMap={};I.idValueMap={};ids=[];var J=function(){for(var K=0,L;K<I.headers.length;K++){L=I.headers[K];L.index=K;if(L.meta){L.items=Ext.clone(H.dimensionNameIdsMap[L.name])||[];L.size=L.items.length;ids=ids.concat(L.items)}}for(var K=0,L;K<I.headers.length;K++){L=I.headers[K];I.nameHeaderMap[L.name]=L}}();var G=function(){for(var K=0,M,L;K<ids.length;K++){M=ids[K];if(M.indexOf("-")!==-1){L=M.split("-");I.metaData.names[M]=I.metaData.names[L[0]]+" "+I.metaData.names[L[1]]}}}();var F=function(){var P=I.nameHeaderMap[i.finals.dimension.value.value].index,L=I.nameHeaderMap[i.finals.dimension.category.dimensionName],T=l.data.dimensionName,Q=l.category.dimensionName,N=H.axisDimensionNames,R=[];for(var O=0;O<N.length;O++){R.push(I.nameHeaderMap[N[O]].index);if(L&&!Ext.Array.contains(N,Q)&&N[O]===T){R.push(L.index)}}for(var O=0,S,K;O<I.rows.length;O++){S=I.rows[O];K="";for(var M=0;M<R.length;M++){K+=S[R[M]]}I.idValueMap[K]=S[P]}}();return I};p=function(J,aj,O){if(!aj||(Ext.isArray(aj)&&!aj.length)){return}var aj=Ext.clone(aj),I=[],S=J==="col"?"colSpan":"rowSpan",U=1,ac=[],K=[],ai=[],P=[],L=[],Q=[],ah=[],R;for(var ae=0;ae<aj.length;ae++){I.push({dimensionName:aj[ae]})}R=function(){var an=[];for(var ao=0,ap;ao<I.length;ao++){ap=I[ao];an.push(O.nameHeaderMap[ap.dimensionName].items)}return an}();for(var ae=0,ab;ae<R.length;ae++){nNumCols=R[ae].length;ac.push(nNumCols);U=U*nNumCols;K.push(U)}for(var ae=0;ae<R.length;ae++){if(ac[ae]===1){if(ae===0){ai.push(U)}else{if(C.hideEmptyRows&&J==="row"){ai.push(U/K[ae])}else{ai.push(ai[0])}}}else{ai.push(U/K[ae])}}P.push(R[0]);if(R.length>1){for(var ae=1,ak,X;ae<R.length;ae++){ak=[];X=ac[ae]===1?ac[0]:K[ae-1];for(var aa=0;aa<X;aa++){ak=ak.concat(R[ae])}P.push(ak)}}for(var ae=0,ag,al,ad,V;ae<R.length;ae++){ag=[];al=R[ae];ad=ai[ae];V=U/(ad*al.length);for(var aa=0;aa<V;aa++){for(var Z=0;Z<al.length;Z++){for(var Y=0;Y<ad;Y++){ag.push(al[Z])}}}L.push(ag)}for(var ae=0,W;ae<U;ae++){W="";for(var aa=0;aa<L.length;aa++){W+=L[aa][ae]}Q.push(W)}for(var ae=0,H;ae<L.length;ae++){H=[];for(var aa=0;aa<L[ae].length;aa++){H.push({id:L[ae][aa],uuid:Ext.data.IdGenerator.get("uuid").generate(),dim:ae,axis:J})}ah.push(H)}for(var ae=0;ae<ah.length;ae++){for(var aa=0,T;aa<ah[ae].length;aa+=ai[ae]){T=ah[ae][aa];T[S]=ai[ae];T.children=Ext.isDefined(ai[ae+1])?ai[ae]/ai[ae+1]:0;if(ae===0){T.root=true}}}if(ah.length>1){for(var ae=1,H;ae<ah.length;ae++){H=ah[ae];for(var aa=0,T,N=0,ad=ai[ae-1],M=ah[ae-1][0];aa<H.length;aa++){T=H[aa];T.parent=M;N++;if(N===ad){M=ah[ae-1][aa+1];N=0}}}}if(ah.length){for(var ae=0,af,F,T,ad=ah.length>1?ai[ah.length-2]:1,G=[];ae<ah[ah.length-1].length;ae++){af=ah[ah.length-1][ae];G.push(af.uuid);F=[];T=af;while(T.parent){T=T.parent;F.push(T.uuid)}af.uuids=Ext.clone(F);if(G.length===ad){for(var aa=ae-ad+1,af;aa<=ae;aa++){af=ah[ah.length-1][aa];af.uuids=af.uuids.concat(Ext.clone(G))}G=[]}}}for(var ae=0;ae<ah.length;ae++){for(var aa=0,am;aa<ah[ae].length;aa++){am=ah[ae][aa];D[am.uuid]=am}}return{type:J,items:I,xItems:{unique:R,gui:P,all:L},objects:{all:ah},ids:Q,span:ai,dims:R.length,size:U}};y=function(F){if(!Ext.isString(F)||F.length>2000){var G=((F.length-2000)/F.length)*100;alert("Too many parameters selected. Please reduce the number of parameters by at least "+Ext.Number.toFixed(G,0)+"%.");return}return true};z=function(){var G;for(var F in v){if(v.hasOwnProperty(F)){G=Ext.get(F);if(parseFloat(G.dom.textContent)){G.dom.pt=x;G.dom.setAttribute("onclick","this.pt.engine.onMouseClick(this.id, this.pt);")}}}};B=function(X,R,H){var N,S,F,G,U,K,I,M,P,T,Z,L=function(aa){if(!aa){return null}var ab=aa.xItems.unique;if(ab){if(ab.length<2){return 1}else{return aa.size/ab[0].length}}return null},W=L(X),Q=L(R),O=[],Y=[],J=[],V;N=function(aa,ab){ab=ab||2;return parseFloat(x.util.number.roundIf(aa,2)).toString()};S=function(ad){var ak,al,ah,ai,ab,ac,ao,ag=Ext.isObject(o)&&Ext.isArray(o.mapLegends)&&o.mapLegends.length,aa=Ext.isObject(ad)&&Ext.isString(ad.type)&&ad.type.substr(0,5)==="value"&&!ad.empty,aj=Ext.isObject(ad)&&Ext.isString(ad.type)&&ad.type==="value"&&!ad.empty,an="",af="";if(!Ext.isObject(ad)){return""}if(aa&&ag){al=o.mapLegends;for(var ae=0,am;ae<al.length;ae++){am=parseFloat(ad.value);if(Ext.Number.constrain(am,al[ae].sv,al[ae].ev)===am){ak=al[ae].color}}}ah=ad.colSpan?'colspan="'+ad.colSpan+'" ':"";ai=ad.rowSpan?'rowspan="'+ad.rowSpan+'" ':"";ab=ad.collapsed?"":ad.htmlValue||ad.value||"";ab=ad.type!=="dimension"?x.util.number.pp(ab,C.digitGroupSeparator):ab;ac=i.pivot.displayDensity[ad.displayDensity]||i.pivot.displayDensity[C.displayDensity];ao=i.pivot.fontSize[ad.fontSize]||i.pivot.fontSize[C.fontSize];an+=ad.hidden?" td-hidden":"";an+=ad.collapsed?" td-collapsed":"";an+=aj?" pointer":"";an+=ak?" legend":(ad.cls?" "+ad.cls:"");af+="<td "+(ad.uuid?('id="'+ad.uuid+'" '):"")+' class="'+an+'" '+ah+ai;if(ak){af+=">";af+='<div class="legendCt">';af+='<div class="number '+ad.cls+'" style="padding:'+ac+"; padding-right:3px; font-size:"+ao+'">'+ab+"</div>";af+='<div class="arrowCt '+ad.cls+'">';af+='<div class="arrow" style="border-bottom:8px solid transparent; border-right:8px solid '+ak+'">&nbsp;</div>';af+="</div></div></div></td>"}else{af+='style="padding:'+ac+"; font-size:"+ao+';">'+ab+"</td>"}return af};F=function(aa){return !!C.showSubTotals&&aa&&aa.dims>1};G=function(){return !!C.showTotals};U=function(){var aa=[],ad;ad=function(){return(X&&R)?S({cls:"pivot-dim-empty",colSpan:R.dims,rowSpan:X.dims}):""};if(!(X&&Ext.isObject(X))){return aa}for(var ae=0,ag;ae<X.dims;ae++){ag=[];if(ae===0){ag.push(ad())}for(var ac=0,af,ab=0;ac<X.size;ac++){ab++;af=X.objects.all[ae][ac];af.type="dimension";af.cls="pivot-dim";af.noBreak=false;af.hidden=!(af.rowSpan||af.colSpan);af.htmlValue=A(af.id,H,true);ag.push(S(af));if(ae===0&&ab===X.span[ae]&&F(X)){ag.push(S({type:"dimensionSubtotal",cls:"pivot-dim-subtotal",rowSpan:X.dims}));ab=0}if(ae===0&&(ac===X.size-1)&&G()){ag.push(S({type:"dimensionTotal",cls:"pivot-dim-total",rowSpan:X.dims,htmlValue:"Total"}))}}aa.push(ag)}return aa};K=function(){var aM=[],aA=[],ay,ah=[],at=[],aq,ad=X?X.size:1,ae=R?R.size:1,ar;ar=function(aN){if(!aN.children){aN.collapsed=true;if(aN.parent){aN.parent.children=aN.parent.children-1}}if(aN.parent){ar(aN.parent)}};if(R){for(var aI=0,ap;aI<R.size;aI++){ap=[];for(var aH=0,af,aC;aH<R.dims;aH++){af=R.objects.all[aH][aI];af.type="dimension";af.cls="pivot-dim td-nobreak"+(q(af.id,H)?" align-left":"");af.noBreak=true;af.hidden=!(af.rowSpan||af.colSpan);af.htmlValue=A(af.id,H,true);ap.push(af)}aA.push(ap)}}for(var aI=0,ac,ag,aF=Ext.clone(H.idValueMap);aI<ae;aI++){ac=[];ag=[];for(var aH=0,ax,aD,aK,aa,aj,ab;aH<ad;aH++){aa=false;ab=[];ax=(X?x.util.str.replaceAll(X.ids[aH],"-",""):"")+(R?x.util.str.replaceAll(R.ids[aI],"-",""):"");aj=Ext.data.IdGenerator.get("uuid").generate();if(X){ab=ab.concat(X.objects.all[X.dims-1][aH].uuids)}if(R){ab=ab.concat(R.objects.all[R.dims-1][aI].uuids)}if(aF[ax]){aD=parseFloat(aF[ax]);aK=aD.toString()}else{aD=0;aK="";aa=true}ac.push(aD);ag.push({uuid:aj,type:"value",cls:"pivot-value",value:aD,htmlValue:aK,empty:aa,uuids:ab});v[aj]=ab}O.push(ac);Y.push(ag)}if(X&&G()){for(var aI=0,aa=[],aw=0;aI<Y.length;aI++){for(aH=0,af;aH<Y[aI].length;aH++){af=Y[aI][aH];aa.push(af.empty);aw+=af.value}ah.push({type:"valueTotal",cls:"pivot-value-total",value:aw,htmlValue:Ext.Array.contains(aa,false)?N(aw):"",empty:!Ext.Array.contains(aa,false)});aa=[];aw=0}}if(X&&R){if(C.hideEmptyRows){for(var aI=0,az,aa,am;aI<Y.length;aI++){az=Y[aI];aa=[];for(var aH=0;aH<az.length;aH++){aa.push(!!az[aH].empty)}if(!Ext.Array.contains(aa,false)&&R){for(var aH=0;aH<az.length;aH++){az[aH].collapsed=true}if(G()){ah[aI].collapsed=true}am=aA[aI][R.dims-1];ar(am)}}}}ay=Ext.clone(Y);if(F(X)){var au=[];for(var aI=0,ap,an,ao;aI<ay.length;aI++){ap=[];an=0;ao=0;for(var aH=0,av,aL=[],aa=[];aH<ay[aI].length;aH++){av=ay[aI][aH];an+=av.value;aa.push(!!av.empty);aL.push(!!av.collapsed);ao++;ap.push(av);if(ao===W){ap.push({type:"valueSubtotal",cls:"pivot-value-subtotal",value:an,htmlValue:Ext.Array.contains(aa,false)?N(an):"",empty:!Ext.Array.contains(aa,false),collapsed:!Ext.Array.contains(aL,false)});ao=0;an=0;aa=[];aL=[]}}au.push(ap)}ay=au}if(F(R)){var ai=[],au=[],aJ=[],aG;aG=function(aQ){var aP=[];for(var aN=0,aO;aN<R.dims;aN++){aO={};aO.type="dimensionSubtotal";aO.cls="pivot-dim-subtotal";aO.collapsed=Ext.Array.contains(aQ,true);if(aN===0){aO.htmlValue="";aO.colSpan=R.dims}else{aO.hidden=true}aP.push(aO)}return aP};for(var aI=0,ap,aL=[];aI<aA.length;aI++){ai.push(aA[aI]);aL.push(!!aA[aI][0].collapsed);if(!Ext.isArray(aA[aI+1])||!!aA[aI+1][0].root){ai.push(aG(aL));aL=[]}}for(var aI=0;aI<ai.length;aI++){au.push([])}for(var aI=0;aI<ay[0].length;aI++){for(var aH=0,ak=0,aB=0,al=0,aa=[],aL,av;aH<ay.length;aH++){av=ay[aH][aI];au[aB++].push(av);al+=av.value;aa.push(!!av.empty);ak++;if(aA[aH][0].root){aL=!!aA[aH][0].collapsed}if(!Ext.isArray(aA[aH+1])||aA[aH+1][0].root){au[aB++].push({type:av.type==="value"?"valueSubtotal":"valueSubtotalTotal",value:al,htmlValue:Ext.Array.contains(aa,false)?N(al):"",collapsed:aL,cls:av.type==="value"?"pivot-value-subtotal":"pivot-value-subtotal-total"});ak=0;al=0;aa=[]}}}for(var aI=0,af,aL=[],aa=[],al=0,aE=0;aI<ah.length;aI++){af=ah[aI];aJ.push(af);aL.push(!!af.collapsed);aa.push(!!af.empty);al+=af.value;aE++;if(aE===R.span[0]){aJ.push({type:"valueTotalSubgrandtotal",cls:"pivot-value-total-subgrandtotal",value:al,htmlValue:Ext.Array.contains(aa,false)?N(al):"",empty:!Ext.Array.contains(aa,false),collapsed:!Ext.Array.contains(aL,false)});aL=[];aa=[];al=0;aE=0}}aA=ai;ay=au;ah=aJ}for(var aI=0,ap;aI<ay.length;aI++){ap=[];if(R){ap=ap.concat(aA[aI])}ap=ap.concat(ay[aI]);if(X){ap=ap.concat(ah[aI])}at.push(ap)}for(var aI=0,ap;aI<at.length;aI++){ap=[];for(var aH=0;aH<at[aI].length;aH++){ap.push(S(at[aI][aH]))}aM.push(ap)}return aM};M=function(){var ah=[];if(R&&G()){var ak;for(var ac=0,ag=0,af=[];ac<Y[0].length;ac++){for(var aa=0,ab;aa<Y.length;aa++){ab=Y[aa][ac];ag+=ab.value;af.push(!!ab.empty)}J.push({type:"valueTotal",value:ag,htmlValue:Ext.Array.contains(af,false)?N(ag):"",empty:!Ext.Array.contains(af,false),cls:"pivot-value-total"});ag=0;af=[]}ak=Ext.clone(J);if(X&&F(X)){var ad=[];for(var ac=0,aj,ae=0,af=[],ai=0;ac<ak.length;ac++){aj=ak[ac];ad.push(aj);ae+=aj.value;af.push(!!aj.empty);ai++;if(ai===W){ad.push({type:"valueTotalSubgrandtotal",value:ae,htmlValue:Ext.Array.contains(af,false)?N(ae):"",empty:!Ext.Array.contains(af,false),cls:"pivot-value-total-subgrandtotal"});ae=0;ai=0}}ak=ad}for(var ac=0;ac<ak.length;ac++){ah.push(S(ak[ac]))}}return ah};P=function(){var ac=0,ad=[],aa=[];if(G()){for(var ab=0,ae;ab<J.length;ab++){ae=J[ab];ac+=ae.value;ad.push(ae.empty)}if(X&&R){aa.push(S({type:"valueGrandTotal",cls:"pivot-value-grandtotal",htmlValue:Ext.Array.contains(ad,false)?N(ac):"",empty:!Ext.Array.contains(ad,false)}))}}return aa};T=function(){var ac,ab=M(),ad=P(),ae,aa=[];if(G()){if(R){ac=[S({type:"dimensionSubtotal",cls:"pivot-dim-total",colSpan:R.dims,htmlValue:"Total"})]}ae=[].concat(ac||[],Ext.clone(ab)||[],Ext.clone(ad)||[]);aa.push(ae)}return aa};Z=function(){var ab='<table id="'+E+'" class="pivot">';for(var aa=0;aa<V.length;aa++){ab+="<tr>"+V[aa].join("")+"</tr>"}return ab+="</table>"};V=[].concat(U(),K(),T());V=Ext.Array.clean(V);return Z(V)};t=function(I,K,N){if(x.isPlugin){var L=Ext.get(x.init.el),J=parseInt(L.getStyle("border-left-width"))+parseInt(L.getStyle("border-right-width")),G=parseInt(L.getStyle("border-top-width"))+parseInt(L.getStyle("border-bottom-width")),H=parseInt(L.getStyle("padding-left"))+parseInt(L.getStyle("padding-right")),M=parseInt(L.getStyle("padding-top"))+parseInt(L.getStyle("padding-bottom")),F=Ext.get(E);x.viewport.centerRegion.setWidth(F.getWidth());x.viewport.centerRegion.setHeight(F.getHeight());L.setWidth(F.getWidth()+J+H);L.setHeight(F.getHeight()+G+M)}else{if(PT.isSessionStorage){z();j.setSessionStorage("table",I)}if(w){x.viewport.setGui(I,K,w,s)}}h.mask.hideMask(x.viewport.centerRegion);x.uuidDimUuidsMap=v;x.uuidObjectMap=D;x.layout=I;x.xLayout=K;x.xResponse=N;if(PT.isDebug){console.log("xResponse",N);console.log("xLayout",K)}};n=function(){var F=j.getExtendedLayout(C),H=j.getParamString(F,true),I="GET",G;G=function(J){var M,L,K,J=x.api.response.Response(J);if(!J){x.util.mask.hideMask(x.viewport.centerRegion);return}F=u(F,J);if(!F){x.util.mask.hideMask(x.viewport.centerRegion);return}M=r(J,F);xColAxis=p("col",F.columnDimensionNames,M);xRowAxis=p("row",F.rowDimensionNames,M);K=B(xColAxis,xRowAxis,M);x.viewport.centerRegion.update(K);x.paramString=H;t(C,F,M)};if(!y(m.contextPath+"/api/analytics.jsonp"+H)){return}h.mask.showMask(x.viewport.centerRegion);if(x.isPlugin){Ext.data.JsonP.request({method:I,url:m.contextPath+"/api/analytics.jsonp"+H,disableCaching:false,success:G})}else{Ext.Ajax.request({method:I,url:m.contextPath+"/api/analytics.json"+H,timeout:60000,headers:{"Content-Type":"application/json",Accept:"application/json"},disableCaching:false,failure:function(J){h.mask.hideMask(x.viewport.centerRegion);alert(J.responseText)},success:function(J){G(Ext.decode(J.responseText))}})}}()};j.loadTable=function(p,v,s,u){var o=m.contextPath+"/api/reportTables/"+p,r="?viewClass=dimensional&links=false",n="GET",t,q;if(!Ext.isString(p)){alert("Invalid uid");return}t=function(x){var w=k.layout.Layout(x);if(w){v.favorite=Ext.clone(w);v.favorite.id=x.id;v.favorite.name=x.name;j.createTable(w,v,s,u)}};q=function(w){h.mask.hideMask(v.viewport.centerRegion);alert(w)};if(v.isPlugin){Ext.data.JsonP.request({url:o+".jsonp"+r,method:n,failure:function(w){q(w)},success:function(w){t(w)}})}else{Ext.Ajax.request({url:o+".json"+r,method:n,failure:function(w){q(w.responseText)},success:function(w){t(Ext.decode(w.responseText))}})}};j.onMouseHover=function(p,q,t,r){var s;if(t==="chart"){if(Ext.isString(p)&&Ext.isArray(r.uuidDimUuidsMap[p])){s=r.uuidDimUuidsMap[p];for(var n=0,o;n<s.length;n++){o=Ext.get(s[n]);if(o){if(q==="mouseover"){o.addCls("highlighted")}else{if(q==="mouseout"){o.removeCls("highlighted")}}}}}}};j.onMouseClick=function(n,x){var u=this,r=x.uuidDimUuidsMap[n],p=Ext.clone(x.layout),w=[],o;for(var t=0;t<r.length;t++){w.push(x.uuidObjectMap[r[t]])}for(var t=0,v=[].concat(p.columns,p.rows);t<v.length;t++){v[t].items=[]}for(var t=0,s,q;t<w.length;t++){s=w[t];q=s.axis==="col"?p.columns||[]:p.rows||[];if(q.length){q[s.dim].items.push({id:s.id,name:x.xResponse.metaData.names[s.id]})}}o=Ext.create("Ext.menu.Menu",{shadow:true,showSeparator:false,items:[{text:"Open selection as chart&nbsp;&nbsp;",iconCls:"pt-button-icon-chart",param:"chart",handler:function(){u.setSessionStorage("analytical",p,x.init.contextPath+"/dhis-web-visualizer/app/index.html?s=analytical")},listeners:{render:function(){this.getEl().on("mouseover",function(){u.onMouseHover(n,"mouseover","chart",x)});this.getEl().on("mouseout",function(){u.onMouseHover(n,"mouseout","chart",x)})}}},{text:"Open selection as map&nbsp;&nbsp;",iconCls:"pt-button-icon-map",param:"map",disabled:true,handler:function(){u.setSessionStorage("analytical",p,x.init.contextPath+"/dhis-web-mapping/app/index.html?s=analytical")},listeners:{render:function(){this.getEl().on("mouseover",function(){u.onMouseHover(n,"mouseover","map",x)});this.getEl().on("mouseout",function(){u.onMouseHover(n,"mouseout","map",x)})}}}]});o.showAt(function(){var y=Ext.get(n),z=y.getXY();z[0]+=y.getWidth()-5;z[1]+=y.getHeight()-5;return z}())}}());PT.core.instances.push({conf:i,util:h,init:m,api:k,service:g,engine:j});return PT.core.instances[PT.core.instances.length-1]};css="table.pivot { \n font-family: arial,sans-serif,ubuntu,consolas; \n } \n";css+=".td-nobreak { \n white-space: nowrap; \n } \n";css+=".td-hidden { \n display: none; \n } \n";css+=".td-collapsed { \n display: none; \n } \n";css+="table.pivot { \n border-collapse: collapse; \n border-spacing: 0px; \n border: 0 none; \n } \n";css+=".pivot td { \n padding: 5px; \n border: \n 1px solid #b2b2b2; \n } \n";css+=".pivot-dim { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-dim.highlighted { \n	background-color: #c5d8f6; \n } \n";css+=".pivot-dim-subtotal { \n background-color: #cad6e8; \n text-align: center; \n } \n";css+=".pivot-dim-total { \n background-color: #bac6d8; \n text-align: center; \n } \n";css+=".pivot-dim-empty { \n background-color: #dae6f8; \n text-align: center; \n } \n";css+=".pivot-value { \n background-color: #fff; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal { \n background-color: #f4f4f4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-subtotal-total { \n background-color: #e7e7e7; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total { \n background-color: #e4e4e4; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-total-subgrandtotal { \n background-color: #d8d8d8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".pivot-value-grandtotal { \n background-color: #c8c8c8; \n white-space: nowrap; \n text-align: right; \n } \n";css+=".x-mask-msg { \n padding: 0; \n	border: 0 none; \n background-image: none; \n background-color: transparent; \n } \n";css+=".x-mask-msg div { \n background-position: 11px center; \n } \n";css+=".x-mask-msg .x-mask-loading { \n border: 0 none; \n	background-color: #000; \n color: #fff; \n border-radius: 2px; \n padding: 12px 14px 12px 30px; \n opacity: 0.65; \n } \n";css+=".pivot td.legend { \n padding: 0; \n } \n";css+=".pivot div.legendCt { \n display: table; \n float: right; \n width: 100%; \n } \n";css+=".pivot div.arrowCt { \n display: table-cell; \n vertical-align: top; \n width: 8px; \n } \n";css+=".pivot div.arrow { \n width: 0; \n height: 0; \n } \n";css+=".pivot div.number { \n display: table-cell; \n } \n",css+=".pivot div.legendColor { \n display: table-cell; \n width: 2px; \n } \n";Ext.util.CSS.createStyleSheet(css);PT.plugin={};var e={user:{}},d=[],f=false,b=false,a,c;a=function(g){var m=false,l=[],k=0,j;j=function(){if(++k===l.length){b=true;for(var n=0;n<d.length;n++){c(d[n])}d=[]}};l.push({url:g+"/api/system/context.jsonp",success:function(i){e.contextPath=i.contextPath;j()}});l.push({url:g+"/api/organisationUnits.jsonp?userOnly=true&viewClass=detailed&links=false",success:function(o){var n=o.organisationUnits||[];if(n.length){var i=n[0];if(i.id){e.user={ou:i.id};e.user.ouc=i.children?Ext.Array.pluck(i.children,"id"):null}}else{console.log("User is not assigned to any organisation units")}j()}});l.push({url:g+"/api/mapLegendSets.jsonp?viewClass=detailed&links=false&paging=false",success:function(i){e.legendSets=Ext.isArray(i.mapLegendSets)?i.mapLegendSets:[];j()}});l.push({url:g+"/api/dimensions.jsonp?links=false&paging=false",success:function(i){e.dimensions=Ext.isArray(i.dimensions)?i.dimensions:[];j()}});for(var h=0;h<l.length;h++){Ext.data.JsonP.request(l[h])}};c=function(j){var l,i,h,g,k;l=function(m){if(!Ext.isObject(m)){console.log("Report table configuration is not an object");return}if(!Ext.isString(m.el)){console.log("No valid element id provided");return}m.id=m.id||m.uid;return true};i=function(n){var m=n.util||{},o=n.init||{};o.el=j.el};h=function(){var m,n;m=function(o){k.engine.createTable(o,k)};return{setFavorite:m,centerRegion:Ext.get(j.el)}};g=function(){if(!l(j)){return}k=PT.core.getInstance(Ext.clone(e));i(k);k.isPlugin=true;k.viewport=h();if(j.id){k.engine.loadTable(j.id,k)}else{layout=k.api.layout.Layout(j);if(!layout){return}k.engine.createTable(layout,k)}}()};PT.plugin.getTable=function(g){if(Ext.isString(g.url)&&g.url.split("").pop()==="/"){g.url=g.url.substr(0,g.url.length-1)}if(b){c(g)}else{d.push(g);if(!f){f=true;a(g.url)}}};DHIS=Ext.isObject(window.DHIS)?DHIS:{};DHIS.getTable=PT.plugin.getTable});